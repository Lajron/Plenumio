@model List<PostDto>

<div class="bg-dark text-light rounded">
    @foreach (var post in Model) {
        <div class="card mb-4 shadow-sm bg-dark-custom text-light">
            <div class="card-body">

                <!-- Header with Follow -->
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="d-flex align-items-center">
                        <img src="@(post.Author.AvatarUrl?.Trim() ?? "https://picsum.photos/50")"
                             alt="@post.Author.Username"
                             class="rounded-circle me-2 border border-2 border-secondary" width="50" height="50" />
                        <div>
                            <strong>@post.Author.Username</strong><br />
                            <small class="text-muted">@post.CreatedAt.ToString("dd.MM.yyyy HH:mm")</small>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-success btn-outline-white">Follow</button>
                </div>

                <!-- Text -->
                <p class="mb-3">@post.Description</p>

                <!-- Horizontalni red slika sa fade -->
                @if (post.Images.Any()) {
                    <div class="position-relative mb-3" style="overflow:hidden;">
                        <div class="d-flex" style="gap:5px; overflow-x:auto; scroll-behavior:smooth;">
                            @foreach (var img in post.Images) {
                                <img src="@img.Url" class="border border-dark"
                                     style="height:150px; object-fit:cover; cursor:pointer;"
                                     data-bs-toggle="modal" data-bs-target="#imagesModal-@post.Id" />
                            }
                        </div>
                        <div class="position-absolute top-0 end-0 h-100"
                             style="width:50px; background: linear-gradient(to left, rgba(28, 28, 28, 1), rgba(33,37,41,0)); pointer-events:none;"></div>
                    </div>

                    <!-- Modal carousel -->
                    <div class="modal fade" id="imagesModal-@post.Id" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content bg-dark text-light">
                                <div id="modalCarousel-@post.Id" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        @for (int i = 0; i < post.Images.Count(); i++) {
                                            var img = post.Images.ElementAt(i);
                                            <div class="carousel-item @(i == 0 ? "active" : "") text-center">
                                                <img src="@img.Url" class="img-fluid rounded" />
                                            </div>
                                        }
                                    </div>
                                    @if (post.Images.Count() > 1) {
                                        <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel-@post.Id" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon"></span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel-@post.Id" data-bs-slide="next">
                                            <span class="carousel-control-next-icon"></span>
                                        </button>
                                    }
                                </div>
                                <div class="modal-footer border-top border-light">
                                    <button type="button" class="btn btn-sm btn-outline-light" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Tags -->
                @if (post.Tags.Any()) {
                    <div class="mb-2 bg-dark-custom border-bottom border-dark">
                        @foreach (var tag in post.Tags) {
                            <span class="badge rounded-0 bg-dark me-1">#@tag.Name</span>
                        }
                    </div>
                }

                <!-- Like / Share -->
                <div class="d-flex justify-content-between mb-2">
                    <button class="btn btn-sm btn-dark btn-outline-black">❤️ Like (@post.LikesCount)</button>
                    <button class="btn btn-sm btn-dark btn-outline-black">↗️ Share</button>
                </div>

                <!-- Komentari auto-carousel -->
                @if (post.Comments.Any()) {
                    <div id="commentsCarousel-@post.Id" class="carousel slide bg-dark px-3 py-2 mb-2 rounded" data-bs-ride="carousel" data-bs-interval="5000">
                        <div class="carousel-inner">
                            @for (int i = 0; i < post.Comments.Count(); i++) {
                                var comment = post.Comments.ElementAt(i);
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <div class="d-flex align-items-start gap-2 mb-2 position-relative">

                                        <!-- Avatar + linija -->
                                        <div class="d-flex flex-column align-items-center flex-shrink-0 position-relative">
                                            <img src="@(comment.Author.AvatarUrl?.Trim() ?? "https://picsum.photos/50")"
                                                 alt="@comment.Author.Username"
                                                 class="rounded-circle border border-2 border-secondary" style="z-index: 10" width="40" height="40" />
                                            @* Linija koja izlazi iz centra avatara *@
                                            <div class="bg-secondary" style="position:absolute; top:50%; left:50%; transform:translateX(-50%); width:1px; height:100%;"></div>
                                        </div>

                                        <!-- Tekst komentara -->
                                        <div class="flex-grow-1 p-2 bg-dark">
                                            <div class="d-flex justify-content-between">
                                                <strong>@comment.Author.Username</strong>
                                                <small class="text-muted">@comment.CreatedAt.ToString("dd.MM.yyyy HH:mm")</small>
                                            </div>
                                            <div class="mt-1">@comment.Content</div>
                                        </div>

                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <button class="btn btn-link text-light p-0">Load more comments</button>
                }
            </div>
        </div>
    }
</div>
